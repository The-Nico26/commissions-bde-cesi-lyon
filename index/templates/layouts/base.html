{% load static %}
<!DOCTYPE html>
<html lang="fr-fr">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <title>{% block notitle %}{% block title %}{% endblock %} - {% endblock %}BDE Cesi Lyon</title>

    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:700&display=swap" rel="stylesheet">

    <script src="//code.iconify.design/1/1.0.0-rc1/iconify.min.js"></script>

    <link rel="stylesheet" href="{% static "css/vars.css" %}"/>
    <link rel="stylesheet" href="{% static "css/reset.css" %}"/>
    <link rel="stylesheet" href="{% static "css/base.css" %}"/>
    <link rel="stylesheet" href="{% static "css/framework.css" %}"/>

    <script src="{% static "components/notifications.js" %}"></script>
    <script src="{% static "components/icon.js" %}"></script>
    <script src="{% static "components/user.js" %}"></script>
    <script src="{% static "components/class-switcher.js" %}"></script>
    <script src="{% static "components/mobile-header.js" %}"></script>
    {% block head %}{% endblock %}

    {% block opengraph %}
        <meta property="og:title" content="BDE Cesi Lyon" />
        <meta property="og:image" content="http://{{ request.get_host }}{% static "img/logo.jpg" %}" />
    {% endblock %}
        <meta property="og:site_name" content="BDE Cesi Lyon"/>
        <meta property="og:locale" content="fr_FR" />
        <meta property="og:url" content="{{request.build_absolute_uri}}" />
</head>
<body>

<bde-mobile-header aside-target=".main-aside" class="page-header">{% block header %}{% endblock %}</bde-mobile-header>

<aside class="main-aside">
    <bde-class-switcher class="mobile-close" target=".main-aside" target-class="activated"></bde-class-switcher>
    <header class="main-header">
        <a href="/">
            <img src="{% static "img/logo.jpg" %}" alt="BDE Cesi Lyon"/>
        </a>
    </header>

    {# Authentification #}

    <div class="separator"></div>
    {% if user.is_authenticated %}
        <a href="/logout" class="auth-panel authenticated clickable">
            <bde-user
                    {% if user.profile_picture is not None and user.profile_picture != "" %}
                        image-src="/media/{{ user.profile_picture }}"
                    {% endif %}
                    role="Bienvenue"
            ><span class="name">{{ user.first_name }}</span></bde-user>
            <div class="icon">
                <span class="iconify" data-icon="mdi-power"></span>
            </div>
        </a>
    {% else %}
        <div class="auth-panel unauthenticated">
            <a class="auth-button" href="/login?next={{ request.path }}">
                Se connecter avec Viacesi
            </a>
        </div>
    {% endif %}
    <div class="separator"></div>

    {# Menu principal #}

    <ul class="main-nav nav">
        <li><a href="/commissions" class="clickable">Commissions</a></li>
        <!--<li><a href="#" class="clickable">Financement</a></li>-->
        {% if not user.is_authenticated or perms.commissions.add_commission %}
            <li><a href="/commissions/create" class="clickable rainbow">Créer une commission</a></li>
        {% endif %}
    </ul>
    {% if userCommissions %}
        <div class="separator"></div>
    {% endif %}
    <ul class="nav">
        {% for com in userCommissions %}
            <li><a href="/commissions/{{ com.slug }}" class="clickable small-commission">
                <div class="small-commission-logo"><img src="/media/{{ com.logo }}"/></div>
                <div class="small-commission-info">{{com.name}}</div>
            </a></li>
        {% endfor %}
    </ul>
    <div class="filler"></div>
    <div class="separator"></div>

    {# Infos diverses dans le footer #}

    <footer class="main-footer">
        <ul>
            <li>BDE CESI Lyon</li>
            <li><a href="https://www.facebook.com/BDECesiLyon/">Facebook</a></li>
        </ul>
        <ul>
            <li><a href="#">Status</a></li>
            <li><a href="#">Reglement intérieur</a></li>
        </ul>
        {% if user.is_staff %}
        <ul>
            <li><a href="/admin">Administration avancée</a></li>
        </ul>
        {% endif %}
    </footer>
</aside>
<section class="main-body">
    {% block body %}
    {% endblock %}
</section>
<bde-notification-container class="main-notifications" ></bde-notification-container>

<script>
    (() => {
        let header = document.querySelector(".page-header")
        let body = document.querySelector(".main-body")

        resizePadding()
        window.addEventListener("resize",resizePadding)

        function resizePadding(){
            body.style.paddingTop = `${header.getBoundingClientRect().height}px`
        }
    })()
</script>

<script>
    {% for message in messages %}
        {% if message.level == DEFAULT_MESSAGE_LEVELS.DEBUG %}
            window.notifications.sendDebug("{{ message | escapejs }}")
        {% elif message.level == DEFAULT_MESSAGE_LEVELS.INFO %}
            window.notifications.sendInfo("{{ message | escapejs }}")
        {% elif message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}
            window.notifications.sendSuccess("{{ message | escapejs }}")
        {% elif message.level == DEFAULT_MESSAGE_LEVELS.WARNING %}
            window.notifications.sendWarning("{{ message | escapejs }}")
        {% elif message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}
            window.notifications.sendError("{{ message | escapejs }}")
        {% else %}
            window.notifications.send("{{ message.level | escapejs }}", "{{ message | escapejs }}")
        {% endif %}
    {% endfor %}
</script>

</body>
</html>